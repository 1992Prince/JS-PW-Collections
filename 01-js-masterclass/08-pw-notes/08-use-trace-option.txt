ğŸ§  What is trace in Playwright?

The trace option in Playwright enables detailed tracing of test execution, including:

    - Screenshots
    - DOM snapshots
    - Actions timeline
    - Network requests
    - Console logs, etc.

You can open a .zip trace file in Playwrightâ€™s Trace Viewer to visually debug what happened in the test.


ğŸ“‚ Where is Trace Configured?

In playwright.config.ts or per test:

use: {
  trace: 'on', // or 'retain-on-failure', etc.
}



ğŸ§ª Trace Output Format

Playwright stores traces inside: test-results/<test-name>-<browser>/trace.zip


for below config - 
use: {
    /* Base URL to use in actions like `await page.goto('/')`. */
    // baseURL: 'http://localhost:3000',

    /* Collect trace when retrying the failed test. See https://playwright.dev/docs/trace-viewer */
    trace: 'on',
    screenshot: 'on',
    headless: false
  },

  screenshots and trace both will be stored at : test-results/<test-name>-<browser>/trace.zip
                                                 : test-results/<test-name>-<browser>/screenshot.png
                                                 

ğŸ“‹ All trace Options â€” with Explanation and Use Cases
        - off
        - on 
        - on-all-retries
        - on-first-retry
        - retain-on-failure
        - retain-on-first-failure
        - retry-with-trace


1ï¸âƒ£ 'off'
ğŸ”¹ No trace recording at all
ğŸš« No performance impact
âœ… Best for clean & fast test runs


2ï¸âƒ£ 'on'
ğŸ”¹ Record trace for all test runs, pass or fail
ğŸ—‚ï¸ Trace always saved
ğŸ“¦ Can bloat storage

âœ… Use when: You're actively developing/debugging and want visibility into every test run.
    But mostly avoid it,since it will clutter lots of traces of each test and take lots of space


3ï¸âƒ£ 'retain-on-failure' âœ… (Most used in CI)
ğŸ”¹ Trace is recorded for all runs, but it's only saved if the test fails finally
ğŸƒâ€â™‚ï¸ Saves time and space

trace: 'retain-on-failure'

âœ… Use when: You want to debug only failed tests in CI/CD â€” very practical in real projects.


4ï¸âƒ£ 'on-first-retry'
ğŸ”¹ Trace is recorded only on the first retry,
not on initial run or further retries

trace: 'on-first-retry'

âœ… Use when: You're focusing on flaky tests â€” first retry visibility is enough.


5ï¸âƒ£ 'on-all-retries'
ğŸ”¹ Record trace for all retries, but not the first attempt
ğŸ¥ Covers full retry lifecycle

trace: 'on-all-retries'

âœ… Use when: You want trace data only for retries â€” helps investigate flaky tests.


6ï¸âƒ£ 'retain-on-first-failure'
ğŸ”¹ Trace is kept only for the first failure,even if the test passes on a retry

trace: 'retain-on-first-failure'

âœ… Use when: You're OK with seeing just one failure attempt, not every retry.


7ï¸âƒ£ 'retry-with-trace'
ğŸ”¹ Record trace only during retries,
not on the first run
ğŸ”¸ Similar to on-all-retries, but smarter:
Traces only start when retries start, not before

trace: 'retry-with-trace'
âœ… Use when: You want to reduce overhead and only trace retry paths.

ğŸ”¥ How to Explain in Interview (Hinglish)
"Trace feature Playwright mein ek tarike ka visual debugger hai â€” jisme DOM snapshots, actions, network calls, console logs sab record hota hai.
Main mostly retain-on-failure use karta hoon CI pipelines mein â€” jisse sirf failed tests ka trace save hota hai, aur unnecessary storage nahi lagta.
Agar mujhe flaky tests debug karni ho, toh on-first-retry ya retry-with-trace use karta hoon â€” jisse mujhe pata chalta hai retry ke time kya hua."

ğŸ¯ Bonus: Open Trace Viewer - npx playwright show-trace test-results/login-chromium/trace.zip

Extension for trace file - .zip

--------------------------------------------------------------------------------------------------------

Perfect! Letâ€™s take a realistic scenario â€” you run a test with:

retries: 2

Which means:

â–¶ï¸ Initial Run
ğŸ” Retry #1 (if failed)
ğŸ” Retry #2 (if still failed)

Now Iâ€™ll walk you through how each trace option behaves during these 3 runs, whatâ€™s recorded, 
and what is saved â€” this is the kind of explanation that makes an interviewer think, 
â€œThis person knows the internal workings.â€

ğŸ¯ Test Settings:

// playwright.config.ts
retries: 2,
use: {
  trace: 'OPTION_HERE'
}


âœ… 1. trace: 'off'

Initial Run: âŒ No trace
Retry #1: âŒ No trace
Retry #2: âŒ No trace
Saved: âŒ Nothing saved

ğŸ§  No trace is recorded at all. You get the fastest test runs, 
but no trace data for debugging even if the test fails.


âœ… 2. trace: 'on'

Initial Run: âœ… Trace recorded
Retry #1: âœ… Trace recorded
Retry #2: âœ… Trace recorded
Saved: âœ… All 3 saved (even if test passes)

ğŸ§  Use this during development â€” full insight into every run. But can consume lots of storage.



âœ… 3. trace: 'retain-on-failure'

Initial Run: âœ… Trace recorded
Retry #1: âœ… Trace recorded
Retry #2: âœ… Trace recorded
Saved: âœ… Only saved if test fails finally (after all retries)

ğŸ§  Great for CI â€” everything is recorded, but only final failed trace is saved. Saves space.




âœ… 4. trace: 'on-first-retry'

Initial Run: âŒ No trace
Retry #1: âœ… Trace recorded
Retry #2: âŒ No trace
Saved: âœ… Only retry #1 trace (if test fails at that point)

ğŸ§  Best when debugging flaky tests â€” record just one retry to catch the intermittent issue.



âœ… 5. trace: 'on-all-retries'

Initial Run: âŒ No trace
Retry #1: âœ… Trace recorded
Retry #2: âœ… Trace recorded
Saved: âœ… Only saved if the test fails finally

ğŸ§  Saves time by skipping the initial trace, but records all retries. Good balance for flakiness.


âœ… 6. trace: 'retain-on-first-failure'

Initial Run: âœ… Trace recorded
Retry #1: âŒ No trace
Retry #2: âŒ No trace
Saved: âœ… Only initial runâ€™s trace is saved if it failed there

ğŸ§  Useful when you want just one snapshot of the first failure â€” even if test passes later.



âœ… 7. trace: 'retry-with-trace'

Initial Run: âŒ No trace
Retry #1: âœ… Trace recorded
Retry #2: âœ… Trace recorded
Saved: âœ… Only if test fails finally (saves last retry trace)

ğŸ§  Smart choice when you're only interested in retry behavior. Saves trace only when retrying fails.

